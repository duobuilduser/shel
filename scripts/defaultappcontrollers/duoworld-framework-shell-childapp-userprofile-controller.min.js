function passwordStrengthIndicator(){return{restrict:"A",require:"ngModel",scope:{ngModel:"="},link:function(e,r,t,a){e.strengthText="";var o={measureStrength:function(e){var r=0,t=/[$@&+#-\/:-?{-~!^_`\[\]]/g;return/[a-z]+/.test(e)&&r++,/[A-Z]+/.test(e)&&r++,t.test(e)&&r++,r}},n=r.children(),s=Array.prototype.slice.call(n.children()),c=s.slice(-1)[0],i=s.slice(-2),l=s.slice(-3),d=s.slice(-4);r.after(n);var u=e.$watch("ngModel",function(r){if(angular.forEach(s,function(e){e.style.backgroundColor="#EDF0F3"}),a.$modelValue){var t=o.measureStrength(a.$modelValue);a.$modelValue.length>7&&t>2?angular.forEach(d,function(r){r.style.backgroundColor="#039FD3",e.strengthText="is very strong"}):a.$modelValue.length>5&&t>1?angular.forEach(l,function(r){r.style.backgroundColor="#72B209",e.strengthText="is strong"}):a.$modelValue.length>3&&t>0?angular.forEach(i,function(r){r.style.backgroundColor="#E09015",e.strengthText="is weak"}):(c.style.backgroundColor="#D81414",e.strengthText="is very weak")}});e.$on("$destroy",function(){return u()})},template:'<span id="password-strength-indicator"><span></span><span></span><span></span><span></span><md-tooltip>password strength {{strengthText}}</md-tooltip></span>'}}!function(){var e=function(e,r,t,a,o,n,s,c,l,d,u){function g(r){c.payment().getTransactions(r).success(function(r){e.ledger=r}).error(function(e){console.log(e)})}n.checkSession(),e.authObject={},e.account={},e.ledger=[],e.profilePicture="images/contacts.png",e.showMore=!1,e.showEdit=!0,e.content=r.content;var h={};h=angular.copy(r.content),c.payment().getAccounts().success(function(r){for(e.account=r[0],g(r[0].AccountId),i=0,len=e.account.AccountCards.length;i<len;++i)"Master"==e.account.AccountCards[i].CardType||"Master Card"==e.account.AccountCards[i].CardType?e.account.AccountCards[i].cardImage="img/master_s.png":"Visa"==e.account.AccountCards[i].CardType?e.account.AccountCards[i].cardImage="img/visa_s.png":("Amex"==e.account.AccountCards[i].CardType||"American Express"==e.account.AccountCards[i].CardType)&&(e.account.AccountCards[i].cardImage="img/amex_s.png")}).error(function(e){console.log(e)}),e.editProfile=function(){e.showEdit=!1},e.cancelChanges=function(){e.content=angular.copy(h),e.showEdit=!0},e.saveProfile=function(){if(r.showGlobalProgress=!0,e.editForm.$valid===!0){e.showEdit=!0,console.log(e.content);var t={method:"POST",url:"/apis/profile/userprofile",headers:{"Content-Type":"application/json"},data:e.content};o(t).then(function(t){r.showGlobalProgress=!1,t.data.IsSuccess===!0?(s.toast("Profile Updated","success"),e.showEdit="/img/ic_mode_edit_24px.svg",r.content=e.content,h=angular.copy(e.content)):s.toast(t.data.Message,"error",3e3)},function(e){r.showGlobalProgress=!1,s.toast("Error occurred while saving","error",3e3)}),e.showEdit="/img/ic_mode_edit_24px.svg"}else r.showGlobalProgress=!1,s.toast("Please enter valid data and fill all required feilds","error")},e.editProfilePic=function(e){t.show({controller:"uploadPictureCtrl",templateUrl:"partials/frameworktemplates/uploadPicture.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0}).then(function(e){if("success"==e){var t=r.profilePicture;r.profilePicture="img/cover.png",r.profilePicture=t}})},e.toggleShowMore=function(){e.showMore=!e.showMore},e.changePassword=function(e){t.show({controller:"changePasswordCtrl",templateUrl:"partials/frameworktemplates/changePassword.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0}).then(function(e){e&&console.log(e)})},e.editCard=function(r,a){t.show({controller:"addCardCtrl",templateUrl:"partials/frameworktemplates/newCard.html",parent:angular.element(document.body),targetEvent:r,clickOutsideToClose:!0,locals:{cardObject:a,account:e.account,userObject:e.content}}).then(function(r){r&&(e.account=r)})},e.deleteCard=function(a,o){var n=t.confirm().title("Delete Card").textContent("Are you sure you want to delete the card with the name of "+o.Name+"?").ariaLabel("Delete Card").targetEvent(a).ok("Delete Card").cancel("Cancel");t.show(n).then(function(){r.showGlobalProgress=!0;var a=angular.copy(e.account),n="";for(i=0,len=a.AccountCards.length;i<len;++i)a.AccountCards[i].guid==o.guid&&(n=i);(n||0===n)&&(a.AccountCards.splice(n,1),console.log(n,"replace this card")),c.payment().newCard(a).success(function(o){e.account=a,r.showGlobalProgress=!1,s.toast("Card Successfully Deleted","success",3e3),t.hide(o)}).error(function(e){r.showGlobalProgress=!1,s.alertDialog("Error","Failed to delete card")})})},e.makeDefault=function(a,o){for(i=0,len=e.account.AccountCards.length;i<len;++i)e.account.AccountCards[i]["default"]=!1;o["default"]=!0,r.showGlobalProgress=!0,c.payment().newCard(e.account).success(function(e){r.showGlobalProgress=!1,s.toast("Default card changed","success",3e3),t.hide(e)}).error(function(e){r.showGlobalProgress=!1,s.alertDialog("Error","Could not set Default card due to error")})},e.newCard=function(r){t.hide(),e.content.BillingAddress&&e.content.PhoneNumber?t.show({controller:"addCardCtrl",templateUrl:"partials/frameworktemplates/newCard.html",parent:angular.element(document.body),targetEvent:r,clickOutsideToClose:!0,locals:{cardObject:"",account:e.account,userObject:e.content}}).then(function(r){r&&(e.account=r)}):s.alertDialog("Complete Profile","Please add your Phone Number and Billing Address before adding cards")}};e.$inject=["$scope","$rootScope","$mdDialog","$window","$http","$auth","notifications","$charge","$objectstore","$storage","$uploader"],mambatiFrameworkShell.controller("duoworld-framework-shell-launcher-userprofile-ctrl",e)}(),function(){var e=function(e,r,t,a,o,n,s,c){e.account={},e.card={},e.newCard=!0,e.disableaddBtn=!1;var l=new Date,d=(l.getDate(),l.getMonth()+1),u=l.getFullYear(),g=u;for(e.years=[],i=0,len=30;i<len;++i)e.years.push(u.toString()),u+=1;var h="";e.months=[],e.yearChanged=function(r){if(e.months=[],parseInt(r)==g)for(i=1,len=13;i<len;++i)h=i,h>=d&&(1==h.toString().length&&(h="0"+i),e.months.push(h.toString()));else for(i=1,len=13;i<len;++i)h=i,1==h.toString().length&&(h="0"+i),e.months.push(h)},n&&(e.yearChanged(n.ExpiryYear),e.card=angular.copy(n),e.newCard=!1),e.card.CardType="",e.cardTypes=[{type:"Visa",validPatterns:["41","42","43","44","45","46","47","48","49"],imageUrl:"img/visa_s.png",regExPattern:/^4[0-9]{12}(?:[0-9]{3})?$/},{type:"Master Card",validPatterns:["51","52","53","54","55"],imageUrl:"img/master_s.png",regExPattern:/^5[1-5][0-9]{14}$/},{type:"American Express",validPatterns:["37","34"],imageUrl:"img/amex_s.png",regExPattern:/^3[47][0-9]{13}$/}],r.$watch("cardTypeRoot",function(){e.card.CardType=r.cardTypeRoot}),e.cancel=function(){t.hide()},e.submit=function(){var n=!1,l=!1,d=!1;null==e.card.ExpiryYear||null==e.card.ExpiryMonth?a.toast("Please select the expiry date","error"):n=!0;try{0==e.card.CardType.regExPattern.test(e.card.CardNo)?a.toast("You card no. is invalid","error"):l=!0}catch(u){a.toast("You card no. is invalid","error")}if(e.card.CSV?"Visa"===e.card.CardType.type||"Master Card"===e.card.CardType.type?3===e.card.CSV.length?d=!0:a.toast("CVV Number for "+e.card.CardType.type+" cards should contain 3 digits","error",4e3):"American Express"===e.card.CardType.type&&(4===e.card.CSV.length?d=!0:a.toast("CVV Number for American Express cards should contain 4 digits","error",4e3)):a.toast("Invalid CVV Number","error"),l===!0&&n===!0&&d===!0){e.disableaddBtn=!0,r.showGlobalProgress=!0;var g=angular.copy(e.card);g.CardType=g.CardType.type,null==o&&(o={},o.DeliveyAddress=s.BillingAddress,o.BillingAddress=s.BillingAddress,o.PhoneNumber=s.PhoneNumber,o.AccountBalance=0,o.AccountCards=[]);var h="";for(i=0,len=o.AccountCards.length;i<len;++i)o.AccountCards[i].guid==g.guid&&(h=i);(h||0===h)&&(o.AccountCards.splice(h,1),console.log(h,"replace this card")),"Master"==g.CardType||"Master Card"==g.CardType?g.cardImage="img/master_s.png":"Visa"==g.CardType?g.cardImage="img/visa_s.png":("Amex"==g.CardType||"American Express"==g.CardType)&&(g.cardImage="img/amex_s.png"),o.AccountCards.push(g);var p="Added";e.newCard===!1&&(p="Edited"),c.payment().newCard(o).success(function(o){e.disableaddBtn=!1,r.showGlobalProgress=!1,a.toast("Card Successfully "+p,"success",3e3),t.hide(o)}).error(function(t){e.disableaddBtn=!1,r.showGlobalProgress=!1,console.log(t),a.alertDialog("Error","Failed to add card")})}}};e.$inject=["$scope","$rootScope","$mdDialog","notifications","account","cardObject","userObject","$charge"],mambatiFrameworkShell.controller("addCardCtrl",e)}(),function(){var e=function(e,r,t,a,o){e.disableChangePasswordBtn=!1,e.cancel=function(){t.hide()},e.submit=function(){r.showGlobalProgress=!0,e.newPassword===e.confirmNewPassword?(e.disableChangePasswordBtn=!0,r.showGlobalProgress=!0,console.log(window.location.host+"/auth/ChangePassword/"+e.oldPassword+"/"+e.newPassword),a.get("/auth/ChangePassword/"+e.oldPassword+"/"+e.newPassword).success(function(a){r.showGlobalProgress=!1,"true"==a?(o.toast("Passoword Successfully Changed","success"),t.hide()):o.toast(a,"error"),e.disableChangePasswordBtn=!1,r.showGlobalProgress=!1}).error(function(){r.showGlobalProgress=!1,e.disableChangePasswordBtn=!1,r.showGlobalProgress=!1,o.toast("Error occurred while changing the password","error",3e3)})):o.toast("New Password Confirmation invalid","error",4e3)}};e.$inject=["$scope","$rootScope","$mdDialog","$http","notifications"],mambatiFrameworkShell.controller("changePasswordCtrl",e)}(),mambatiFrameworkShell.directive("customOnChange",function(){return{restrict:"A",link:function(e,r,t){var a=e.$eval(t.customOnChange);r.bind("change",a)}}}),mambatiFrameworkShell.filter("filterByPattern",function(e){return function(r,t){if(!t)return t="",r;for(i=0,len=r.length;i<len;++i)for(j=0,len=r[i].validPatterns.length;j<len;++j){var a=r[i].validPatterns[j].startsWith(t.substring(0,2));if(a===!0)return e.cardTypeRoot=r[i],[r[i]]}}}),mambatiFrameworkShell.directive("angularMask",function(){return{restrict:"A",require:"ngModel",link:function(e,r,t,a){function o(e){if(null===e)return"";var r=String(e).replace(/\D/g,"");if(s.length>1)for(var t in s)if(r.replace(/\D/g,"").length<=s[t].replace(/\D/g,"").length){n=s[t];break}for(var a="",o=0,c=0;c<n.length;){if(n[c].match(/\D/))a+=n[c];else{if(void 0==r[o])break;a+=r[o],o++}c++}return a}var n=t.angularMask,s=n.split("|");s.length>1&&s.sort(function(e,r){return e.length-r.length}),a.$formatters.push(function(e){return null===e?"":o(String(e).replace(/\D/g,""))}),a.$parsers.push(function(e){a.$viewValue=o(e);var t=String(e).replace(/\D/g,"");return r.val(a.$viewValue),t})}}}),mambatiFrameworkShell.directive("passwordStrengthIndicator",passwordStrengthIndicator),mambatiFrameworkShell.filter("hideNumbers",function(){return function(e){return e.replace(/.(?=.{4})/g,"x")}}),function(){var e=function(e,r,t,a,o){function n(e,r){return e.lastModifiedDate=new Date,e.name=r,e}function s(e){var r;r=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var t=(e.split(",")[0].split(":")[1].split(";")[0],new Uint8Array(r.length)),a=0;a<r.length;a++)t[a]=r.charCodeAt(a);return new File([t],{type:"mimeString"})}e.cancel=function(){t.hide()},e.doubleWrap="{{outputImage}}",e.fileChanged=function(r){var t=r.currentTarget.files[0],a=new FileReader;a.onload=function(r){e.$apply(function(e){e.theImage1=r.target.result})},a.readAsDataURL(t)},e.onUpdate=function(e){},e.submit=function(){var e=!0;try{var c=document.getElementById("youtubeimg").src;e=!1}catch(i){e=!0}if(e===!1){r.showGlobalProgress=!0;var l=s(c),d=n(l,"profilepicture");o.onSuccess(function(){a.toast("Profile picture updated","success"),r.showGlobalProgress=!1,t.hide("success")}),o.onError(function(){r.showGlobalProgress=!1,a.toast("Error occured, Profile picture was not updated","error")}),o.uploadMedia("profilepictures",d,"profile.jpg")}else a.toast("Please select a picture","error")}};e.$inject=["$scope","$rootScope","$mdDialog","notifications","$uploader"],mambatiFrameworkShell.controller("uploadPictureCtrl",e)}();
